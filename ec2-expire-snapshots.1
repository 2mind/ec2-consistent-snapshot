.\" Automatically generated by Pod::Man 2.22 (Pod::Simple 3.15)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.ie \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.el \{\
.    de IX
..
.\}
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "EC2-EXPIRE-SNAPSHOTS 1"
.TH EC2-EXPIRE-SNAPSHOTS 1 "2011-08-08" "perl v5.10.1" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
ec2\-expire\-snapshots \- Delete expired EBS snapshots for volumes on EC2
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
.Vb 1
\& ec2\-expire\-snapshots [opts] VOLUMEID...
.Ve
.SH "OPTIONS"
.IX Header "OPTIONS"
.IP "\-h \-\-help" 4
.IX Item "-h --help"
Print help and exit.
.IP "\-d \-\-debug" 4
.IX Item "-d --debug"
Debug mode.
.IP "\-q \-\-quiet" 4
.IX Item "-q --quiet"
Quiet mode.
.IP "\-n \-\-noaction" 4
.IX Item "-n --noaction"
Don't do it. Just say what you would have done.
.IP "\-\-aws\-access\-key\-id \s-1KEY\s0" 4
.IX Item "--aws-access-key-id KEY"
.PD 0
.IP "\-\-aws\-secret\-access\-key \s-1SECRET\s0" 4
.IX Item "--aws-secret-access-key SECRET"
.PD
Amazon \s-1AWS\s0 access key and secret access key.  Defaults to
environment variables or .awssecret file contents described below.
.IP "\-\-aws\-access\-key\-id\-file \s-1KEYFILE\s0" 4
.IX Item "--aws-access-key-id-file KEYFILE"
.PD 0
.IP "\-\-aws\-secret\-access\-key\-file \s-1SECRETFILE\s0" 4
.IX Item "--aws-secret-access-key-file SECRETFILE"
.PD
Files containing Amazon \s-1AWS\s0 access key and secret access key.
Defaults to environment variables or .awssecret file contents
described below.
.IP "\-\-aws\-credentials\-file \s-1CREDENTIALSFILE\s0" 4
.IX Item "--aws-credentials-file CREDENTIALSFILE"
File containing both the Amazon \s-1AWS\s0 access key and secret access
key on seprate lines and in that order.  Defaults to contents of
\&\f(CW$AWS_CREDENTIALS\fR environment variable or the value \f(CW$HOME\fR/.awssecret
.IP "\-\-region \s-1REGION\s0" 4
.IX Item "--region REGION"
Specify a different \s-1EC2\s0 region like \*(L"eu\-west\-1\*(R".  Defaults to
\&\*(L"us\-east\-1\*(R".
.IP "\-\-expiration\-tag\-name \s-1TAGNAME\s0" 4
.IX Item "--expiration-tag-name TAGNAME"
.PD 0
.IP "\-\-expiration\-tag\-optional" 4
.IX Item "--expiration-tag-optional"
.IP "\-\-keep\-first\-yearly \s-1YEARCOUNT\s0" 4
.IX Item "--keep-first-yearly YEARCOUNT"
.IP "\-\-keep\-first\-quarterly \s-1QUARTERCOUNT\s0" 4
.IX Item "--keep-first-quarterly QUARTERCOUNT"
.IP "\-\-keep\-first\-monthly \s-1MONTHCOUNT\s0" 4
.IX Item "--keep-first-monthly MONTHCOUNT"
.IP "\-\-keep\-first\-weekly \s-1WEEKCOUNT\s0" 4
.IX Item "--keep-first-weekly WEEKCOUNT"
.IP "\-\-keep\-first\-daily \s-1DAYCOUNT\s0" 4
.IX Item "--keep-first-daily DAYCOUNT"
.IP "\-\-keep\-first\-hourly \s-1HOURCOUNT\s0" 4
.IX Item "--keep-first-hourly HOURCOUNT"
.IP "\-\-week\-starts \s-1DAYOFWEEK\s0" 4
.IX Item "--week-starts DAYOFWEEK"
.IP "\-\-keep\-most\-recent \s-1COUNT\s0" 4
.IX Item "--keep-most-recent COUNT"
.IP "\-\-keep\-all\-since \s-1DATETIME\s0" 4
.IX Item "--keep-all-since DATETIME"
.PD
These options identify which \s-1EBS\s0 snapshots should be preserved.  See
the \*(L"\s-1PRESERVATION\s0 \s-1OPTIONS\s0\*(R" section for more details on what they mean
and how to use them.
.IP "\-\-force\-delete\-all" 4
.IX Item "--force-delete-all"
This dangerous option overrides all other default option values, \s-1EBS\s0
snapshot tag values, and normal safety measures.  All \s-1EBS\s0 snapshots
for the specified \s-1EBS\s0 volumes are attemped to be deleted. Even the
most recent \s-1EBS\s0 snapshot is deleted.  The \s-1EBS\s0 snapshots are deleted
even if the \s-1EBS\s0 volume does not exist.  After this option is used, you
will have no \s-1EBS\s0 snapshots for the specified \s-1EBS\s0 volume, unless there
was some error condition that prevented an \s-1EBS\s0 snapshot from being
deleted.
.Sp
This is not a normal \s-1EBS\s0 snapshot expiration strategy, but is a
convenience option for use when throwing away all data associated with
an \s-1EBS\s0 volume that is no longer useful for any purpose.
.SH "ARGUMENTS"
.IX Header "ARGUMENTS"
.IP "\s-1VOLUMEID\s0" 4
.IX Item "VOLUMEID"
\&\s-1EBS\s0 volume ids for which \s-1EBS\s0 snapshots are to be expired (deleted).
The \s-1EBS\s0 volume does not have to exist for its \s-1EBS\s0 snapshots to be
found and deleted.
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
This program deletes expired \s-1EBS\s0 snapshots of the specified \s-1EBS\s0
volumes on Amazon \s-1EC2\s0.  Different expiration strategies and
specifications are supported.
.PP
When deciding what options to use, it's easier to think of which \s-1EBS\s0
snapshots should be preserved instead of which should be expired and
deleted.
.PP
As a general rule, all \s-1EBS\s0 snapshots that you have not requested to be
preserved will be deleted.
.PP
Unless overridden, the software always preserves the most recent \s-1EBS\s0
snapshot, along with any \s-1EBS\s0 snapshots where it isn't clear what was
intended (e.g., unrecognized expiration tag values).
.PP
Please read the descriptions of the preservation options carefully.
They might not mean what they look like on first glance.  For example,
these mean two very different things:
.IP "\-\-keep\-all\-since '3 days ago'" 4
.IX Item "--keep-all-since '3 days ago'"
This option asks the program to preserve *every* \s-1EBS\s0 snapshot that was
created since the current time 3 days ago, i.e., the most recent 72
hours.
.IP "\-\-keep\-first\-daily 3" 4
.IX Item "--keep-first-daily 3"
This option asks the program to preserve the first completed \s-1EBS\s0
snapshot that was created on each of the last 3 calendar days
including \*(L"today\*(R", \*(L"yesterday\*(R", and \*(L"2 days ago\*(R", calculated in \s-1UTC\s0.
All other \s-1EBS\s0 snapshots of the \s-1EBS\s0 volume may be deleted unless there
are other conditions specified to prevent that.
.SS "\s-1PRESERVATION\s0 \s-1OPTIONS\s0"
.IX Subsection "PRESERVATION OPTIONS"
The following options control which \s-1EBS\s0 snapshots are preserved.  If
an \s-1EBS\s0 snapshot is not flagged as one to be preserved, then it is
considered expired and will be deleted.
.PP
There are three basic expiration methodologies supported by this
program.
.IP "1. Keep Recent" 4
.IX Item "1. Keep Recent"
This is the simplest approach where you tell the program to preserve a
specifc number of the the most recent \s-1EBS\s0 snapshots created (e.g.,
\&\*(L"10\*(R") and/or to preserve any \s-1EBS\s0 snapshots created since a particular
date/time in the past (e.g., \*(L"7 days ago\*(R").
.Sp
The specific options related to this approach include:
.RS 4
.IP "\-\-keep\-most\-recent \s-1COUNT\s0" 4
.IX Item "--keep-most-recent COUNT"
The most recent \s-1COUNT\s0 completed \s-1EBS\s0 snapshots will be preserved.  By
default, the most recent \s-1EBS\s0 snapshot is always preserved, but this
can be overridden against our recommendation by explicitly specifying
\&\*(L"0\*(R" in this option.
.IP "\-\-keep\-all\-since \s-1DATETIME\s0" 4
.IX Item "--keep-all-since DATETIME"
The \s-1EBS\s0 snapshots that were created at or after \s-1DATETIME\s0 will be
preserved.  The value may be an absolute date/time or it may be
relative to now.
.Sp
See \*(L"\s-1DATE/TIME\s0 \s-1FORMATS\s0\*(R" below for recommended value formats.
.RE
.RS 4
.RE
.IP "2. Keep One Per Calendar Cycle" 4
.IX Item "2. Keep One Per Calendar Cycle"
This approach lets you keep many very recent copies of \s-1EBS\s0 snapshots,
somewhat fewer as you go into the recent past, and more sparse backups
as you get to distant history.  The time frames involved are hourly,
daily, weekly, monthly, quarterly, and yearly.  You can specify as
many or as few of these time periods as you wish, and save as many
cycles of each as you wish.
.Sp
The specific options related to this approach include:
.RS 4
.IP "\-\-keep\-first\-hourly \s-1HOURCOUNT\s0" 4
.IX Item "--keep-first-hourly HOURCOUNT"
.PD 0
.IP "\-\-keep\-first\-daily \s-1DAYCOUNT\s0" 4
.IX Item "--keep-first-daily DAYCOUNT"
.IP "\-\-keep\-first\-weekly \s-1WEEKCOUNT\s0" 4
.IX Item "--keep-first-weekly WEEKCOUNT"
.IP "\-\-keep\-first\-monthly \s-1MONTHCOUNT\s0" 4
.IX Item "--keep-first-monthly MONTHCOUNT"
.IP "\-\-keep\-first\-quarterly \s-1QUARTERCOUNT\s0" 4
.IX Item "--keep-first-quarterly QUARTERCOUNT"
.IP "\-\-keep\-first\-yearly \s-1YEARCOUNT\s0" 4
.IX Item "--keep-first-yearly YEARCOUNT"
.PD
Preserve the first completed \s-1EBS\s0 snapshot created in each of the most
recent \s-1COUNT\s0 hours/days/weeks/months/quarters/years, respectively,
calculated in \s-1UTC\s0.
.Sp
The current hour/day/week/month/quarter/year is considered \*(L"1\*(R".  A
\&\s-1COUNT\s0 of \*(L"all\*(R", case insensitive, is equivalent to an infinitely high
\&\s-1COUNT\s0.
.Sp
A single \s-1EBS\s0 snasphot may match multiple options.  For example, the
first \s-1EBS\s0 snapshot in a month is also going to be the first \s-1EBS\s0
snapshot for a particular day, but perhaps not the first for any
particular week.  There may be no completed \s-1EBS\s0 snapshots in some time
periods.
.Sp
The first completed \s-1EBS\s0 snapshot in a month may have been taken on a
date later than the first day of the month and the dates don't need to
be the same across different months.  It simply preserves the oldest
completed \s-1EBS\s0 snapshot in each relevant time period.
.Sp
If hourly \s-1EBS\s0 snapshots would be to many you, you can simply not
create \s-1EBS\s0 snapshots that often.  For example, you could create \s-1EBS\s0
snapshots every 6 hours and then specify \*(L"\-\-keep\-first\-hourly 30\*(R" to
preserve about 4, depending on what exactly the time stamps are on the
\&\s-1EBS\s0 snapshots.
.IP "\-\-week\-starts \s-1DAYOFWEEK\s0" 4
.IX Item "--week-starts DAYOFWEEK"
Specifies the first day of each week as you think of it.  This is used
in conjunction with \-\-keep\-first\-weekly to know which \s-1EBS\s0 snapshot you
prefer to keep.  Supported values include \*(L"Sun\*(R", \*(L"Sunday\*(R", \*(L"Mon\*(R",
\&\*(L"Monday\*(R", case insensitively.
.RE
.RS 4
.RE
.IP "3. Ask The Snapshot" 4
.IX Item "3. Ask The Snapshot"
This approach transfers the decision making about how long each \s-1EBS\s0
snapshot should be preserved onto some other process, perhaps the one
that creates the \s-1EBS\s0 snapshots in the first place.  That external
process must create or add a tag to each \s-1EBS\s0 snapshot indicating how
long it should be preserved or when it should expire.
.Sp
This gives maximum flexibility for any system that goes beyond the
simple rules understood by this program.  It also allows for
exceptions to be made to these rules by humans who make decisions
about how long a specific \s-1EBS\s0 snapshot should be preserved.
.Sp
The specific options related to this approach include:
.RS 4
.IP "\-\-expiration\-tag\-name \s-1TAGNAME\s0" 4
.IX Item "--expiration-tag-name TAGNAME"
Specifies the name of a tag to look for on each \s-1EBS\s0 snapshot
indicating when that \s-1EBS\s0 snapshot is allowed to expire.  The tag value
can either be an absolute date/time, or a date/time offset expression
that is to be calculated relative to the timestamp of the \s-1EBS\s0
snapshot's creation. For example, Expiration: +8 days
.Sp
If the calculated expiration time is in the future or is unrecognized,
then the \s-1EBS\s0 volume is preserved.  A tag value of \*(L"never\*(R" or \*(L"forever\*(R"
will prevent an \s-1EBS\s0 snapshot from ever being expired.
.Sp
If this option is specified multiple times, then each tag name is
checked on each \s-1EBS\s0 snapshot, and any one of them can trigger the
preservation of an \s-1EBS\s0 snapshot.
.Sp
See \*(L"\s-1DATE/TIME\s0 \s-1FORMATS\s0\*(R" below for recommended tag value formats.
.IP "\-\-expiration\-tag\-optional" 4
.IX Item "--expiration-tag-optional"
By default, if you specify one or more \-\-expiration\-tag\-name options
and an \s-1EBS\s0 snapshot does not have any of those tag names, then that
\&\s-1EBS\s0 snapshot will be preserved.
.Sp
Including the \-\-expiration\-tag\-optional option tells the program that
\&\s-1EBS\s0 snapshots without the expiration tags are allowed to be expired.
.RE
.RS 4
.RE
.PP
It is acceptable and encouraged to include options from across
multiple of these strategies.  This program will preserve all \s-1EBS\s0
snapshots that match any of the conditions.
.PP
For example, you may want to keep 24 hourly, 7 daily, 4 weekly, and 12
monthly \s-1EBS\s0 snapshots as a base strategy.
.PP
Then, you could add the last 3 hours of all \s-1EBS\s0 snapshots just in case
you end up creating some \s-1EBS\s0 snapshots manually during a sensitive
file modification procedure and you don't want your \s-1EBS\s0 snapshots
inadvertently deleted in the event you need to undo some recent work.
.PP
Then, you could add in some optional expiration tags that can be set
to override normal expiration and preserve for a longer time period
any special \s-1EBS\s0 snapshots that you care to flag from time to time.
.SS "\s-1BACKGROUND\s0"
.IX Subsection "BACKGROUND"
The creation of \s-1EBS\s0 snapshots on \s-1EC2\s0 is a risk reduction and safety
improvement measure in a few ways:
.IP "1." 4
An \s-1EBS\s0 snapshot is a form of backup and disaster recovery
preparedness, allowing you to restore data that may have been deleted,
corrupted, or in any other way lost on the \s-1EBS\s0 volume due to hardware,
system, environmental, or human error at a time after the \s-1EBS\s0 snapshot
was created.
.IP "2." 4
\&\s-1EBS\s0 snapshots are available from multiple availability zones in a
given \s-1EC2\s0 region even if the availability zone for the source \s-1EBS\s0
volume is inaccessible.
.IP "3." 4
An \s-1EBS\s0 snapshot automatically and transparently reduces the rate of
failure of the underlying \s-1EBS\s0 volume, due to the way that Amazon has
designed and implemented the \s-1EBS\s0 system.
.Sp
The \s-1EBS\s0 system can automatically recover parts of a failing \s-1EBS\s0 volume
from an \s-1EBS\s0 snapshot, if the blocks that are failing have not been
modified since the \s-1EBS\s0 snapshot was taken.  The more frequently an \s-1EBS\s0
volume is snapshotted, the lower its potential rate of failure.
.PP
With backup strategies using physical media, we normally introduce a
backup rotation strategy because we have a limited amount of disk or
tape to store the backups.  With \s-1EC2\s0, the available \s-1EBS\s0 snapshot space
is perceived as limitless at the level a single organizion could use
it.
.PP
So, why do we want to expire and delete \s-1EBS\s0 snapshots?
.IP "1." 4
\&\s-1EBS\s0 snapshots cost money to store on \s-1EC2\s0.  Even though multiple \s-1EBS\s0
snapshots share the same copies of unchanged blocks, and even though
the block contents are stored in a compressed format, these charges
can add up over time when you have a lot of \s-1EBS\s0 snapshots.
.IP "2." 4
There is a limit on the number of \s-1EBS\s0 snapshots a single \s-1EC2\s0 account
can have at any point in time.  This limit can easily be increased by
submitting a request to Amazon with an explanation of why you need
more, but eventually you're probably going to want to trim back on how
many \s-1EBS\s0 snapshots you retain.
.IP "3." 4
Depending on the tools you are using, it can get unwieldy to manage
large numbers of \s-1EBS\s0 snapshots.
.PP
This program tries to help manage your \s-1EBS\s0 snapshot storage costs by
deleting \s-1EBS\s0 snapshots that you believe are the least helpful to your
backup needs, while preserving a select set of \s-1EBS\s0 snapshots that you
believe are likely to be the most important in the near and distant
future.
.PP
Just remember: When you (or this software) delete an \s-1EBS\s0 snapshot, it
is gone forever and is completely irrecoverable!
.SS "\s-1SAFETY\s0"
.IX Subsection "SAFETY"
This software attempts to be somewhat conservative and to protect you
in a few ways:
.IP "1." 4
This program will exit with error unless you specify at least one of
the preservation options to give this program an indication of what
your expiration strategy is and what \s-1EBS\s0 snapshots should be
preserved.
.IP "2." 4
If you use the \-\-expiration\-tag\-name option and this program cannot
make sense of the value for that tag on one of the \s-1EBS\s0 snapshots, then
that \s-1EBS\s0 snapshot is not deleted.
.IP "3." 4
If you specify \-\-expiration\-tag\-name and \-\-expiration\-tag\-optional
without any of the \-\-keep options, and the tag name(s) are not found
on any \s-1EBS\s0 snapshots, then the program exits with an error instead of
deleting all your \s-1EBS\s0 snapshots.
.IP "4." 4
The most recent \s-1EBS\s0 snapshot for an \s-1EBS\s0 volume is always preserved
unless you explicitly request it to be deleted with:
.Sp
.Vb 1
\& \-\-keep\-most\-recent 0
.Ve
.Sp
Deleting the most recent \s-1EBS\s0 snapshot reduces the reliability of the
\&\s-1EBS\s0 volume and increases the time, \s-1IO\s0, and cost required to create a
new \s-1EBS\s0 snapshot in the future.
.IP "5." 4
If any of the options indicate to this program that an \s-1EBS\s0 snapshot
should be preserved, then it will not be deleted.  For example, even
if there is an expiration tag on an \s-1EBS\s0 snapshot that indicates it should
expire yesterday, it will not be deleted if it is also the first
\&\s-1EBS\s0 snapshot of this month and you specified \-\-keep\-first\-monthly greater
than zero.
.IP "6." 4
\&\s-1EBS\s0 snapshots in the \*(L"pending\*(R" or other non\-\*(L"completed\*(R" states are
completely ignored by this program.  For example, only \*(L"completed\*(R"
snapshots are counted when deciding what is the first snapshot of a
calendar period to preserve.
.Sp
We have no guarantee that a \*(L"pending\*(R" snapshot will ever complete
successfully, but if it does complete before the next time you run
this program, then it will be taken into account in the calculations
and may become the new \*(L"first\*(R" \s-1EBS\s0 snapshot to be preserved for a time
period.
.SS "\s-1DATE/TIME\s0 \s-1FORMATS\s0"
.IX Subsection "DATE/TIME FORMATS"
This software supports and interprets a number of different date
formats, but if you have a choice, here are some samples of
recommended formats for absolute dates and times:
.PP
.Vb 3
\& "2011\-12\-31"
\& "2012\-01\-15 14:56"
\& "2015\-07\-22 09:23:45"
.Ve
.PP
Dates specified without times are assumed to be at \*(L"00:00:00\*(R"
(midnight starting that date).
.PP
This software assumes that dates and times without time zones are in
\&\s-1UTC\s0.
.PP
Here are some samples of recommended formats for relative time
offsets for \*(L"expires in\*(R" tags on \s-1EBS\s0 snapshots:
.PP
.Vb 4
\& "+1 year"
\& "+10 weeks"
\& "+3 days"
\& "+12 hours"
.Ve
.PP
Here are some examples of recommended formats for relative time
offsets for the \-\-keep\-all\-since option:
.PP
.Vb 4
\& "1 year ago"
\& "10 weeks ago"
\& "1 day ago"
\& "12 hours ago"
.Ve
.SH "EXAMPLES"
.IX Header "EXAMPLES"
This example combines a number of preservation strategies, any one of
which could trigger the preservation of a given \s-1EBS\s0 snapshot:
.PP
.Vb 10
\&    ec2\-expire\-snapshots                   \e
\&        \-\-keep\-most\-recent 1               \e
\&        \-\-keep\-all\-since "2 hours ago"     \e
\&        \-\-keep\-first\-hourly 24             \e
\&        \-\-keep\-first\-daily 7               \e
\&        \-\-keep\-first\-weekly 4              \e
\&        \-\-keep\-first\-monthly 12            \e
\&        \-\-keep\-first\-quarterly 0           \e
\&        \-\-keep\-first\-yearly all            \e
\&        \-\-week\-starts sunday               \e
\&        \-\-expiration\-tag\-optional          \e
\&        \-\-expiration\-tag\-name "Expiration" \e
\&        \-\-expiration\-tag\-name "Expires"    \e
\&        \-\-expiration\-tag\-name "Keep\-For"   \e
\&        \-\-expiration\-tag\-name "Keep\-Until" \e
\&        vol\-11111111                       \e
\&        vol\-22222222                       \e
\&        vol\-33333333
.Ve
.PP
If you always determine how long a snapshot should be saved when you
take the \s-1EBS\s0 snapshot and you store this value in a specific tag, then
you may leave out all other \*(L"keep\*(R" options only pay attention to your
tag.  Any volume without the tag will be preserved forever in this
example.
.PP
.Vb 3
\&    ec2\-expire\-snapshots                   \e
\&        \-\-expiration\-tag\-name "Expiration" \e
\&        vol\-44444444
.Ve
.PP
Delete all \s-1EBS\s0 snapshots associated with an \s-1EBS\s0 volume, no matter when
they were taken or what their tags say.  Make sure you really want to
do this.  There is no way to recover.
.PP
.Vb 3
\&    ec2\-expire\-snapshots   \e
\&        \-\-force\-delete\-all \e
\&        vol\-99999999
.Ve
.SH "ENVIRONMENT"
.IX Header "ENVIRONMENT"
.ie n .IP "$AWS_ACCESS_KEY_ID" 4
.el .IP "\f(CW$AWS_ACCESS_KEY_ID\fR" 4
.IX Item "$AWS_ACCESS_KEY_ID"
Default value for access key.
Can be overridden by command line options.
.ie n .IP "$AWS_SECRET_ACCESS_KEY" 4
.el .IP "\f(CW$AWS_SECRET_ACCESS_KEY\fR" 4
.IX Item "$AWS_SECRET_ACCESS_KEY"
Default value for secret access key.  Can be overridden by command
line options.
.ie n .IP "$AWS_CREDENTIALS" 4
.el .IP "\f(CW$AWS_CREDENTIALS\fR" 4
.IX Item "$AWS_CREDENTIALS"
Default value for filename containing both access key and secret
access key on separate lines and in that order. Can be overriden by
the \-\-aws\-credentials command line option.
.SH "FILES"
.IX Header "FILES"
.ie n .IP "$HOME/.my.cnf" 4
.el .IP "\f(CW$HOME\fR/.my.cnf" 4
.IX Item "$HOME/.my.cnf"
Default values for MySQL user and password are sought here in the
standard format.
.ie n .IP "$HOME/.awssecret" 4
.el .IP "\f(CW$HOME\fR/.awssecret" 4
.IX Item "$HOME/.awssecret"
Default values for access key and secret access keys are sought here.
Can be overridden by environment variables and command line options.
.SH "INSTALLATION"
.IX Header "INSTALLATION"
The ec2\-expire\-snapshots program is part of the
\&\fBec2\-consistent\-snapshot\fR package.
.PP
On most Ubuntu releases, the \fBec2\-consistent\-snapshot\fR package can be
installed directly from the Alestic.com \s-1PPA\s0 using the following
commands:
.PP
.Vb 3
\& sudo add\-apt\-repository ppa:alestic
\& sudo apt\-get update
\& sudo apt\-get install ec2\-consistent\-snapshot
.Ve
.PP
This program may also require the installation of the Net::Amazon::EC2
Perl package from \s-1CPAN\s0.  On Ubuntu 10.04 Lucid and higher, this should
happen automatically by the dependency on the libnet\-amazon\-ec2\-perl
package.
.PP
On some earlier releases of Ubuntu you can install the required
package with the following command:
.PP
.Vb 1
\& sudo PERL_MM_USE_DEFAULT=1 cpan Net::Amazon::EC2
.Ve
.PP
On Ubuntu 8.04 Hardy, use the following commands instead:
.PP
.Vb 7
\& code=$(lsb_release \-cs)
\& echo "deb http://ppa.launchpad.net/alestic/ppa/ubuntu $code main"|
\&   sudo tee /etc/apt/sources.list.d/alestic\-ppa.list
\& sudo apt\-key adv \-\-keyserver keyserver.ubuntu.com \-\-recv\-keys BE09C571
\& sudo apt\-get update
\& sudo apt\-get install ec2\-consistent\-snapshot build\-essential
\& sudo cpan Net::Amazon::EC2
.Ve
.PP
The default values can be accepted for most of the prompts, though it
is necessary to select a \s-1CPAN\s0 mirror on Hardy.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
.IP "Amazon \s-1EC2\s0" 4
.IX Item "Amazon EC2"
.PD 0
.IP "Amazon \s-1EC2\s0 \s-1EBS\s0 (Elastic Block Store)" 4
.IX Item "Amazon EC2 EBS (Elastic Block Store)"
.IP "ec2\-consistent\-snapshots" 4
.IX Item "ec2-consistent-snapshots"
.PD
.SH "CAVEATS"
.IX Header "CAVEATS"
\&\s-1EBS\s0 snapshots reduce risk.  This program deletes \s-1EBS\s0 snapshots.
Therefore, use of this program increases risk.
.PP
This program has \s-1NOT\s0 been tested in all possible environments with all
possible combinations of options, settings, \s-1EBS\s0 volume dates, \s-1AWS/EC2\s0
\&\s-1API\s0 responses, operating systems, Perl versions, \s-1CPAN\s0 package
versions, etc.
.PP
This documentation may not accurately convey to you how this program
really works.  You might misinterpret
.PP
This program may contains defects that could cause it to delete one or
more \s-1EBS\s0 snapshot that you did not intend to be deleted.
.PP
It is possible that this program could leave undeleted some \s-1EBS\s0
snapshots that you intended to be deleted, causing you to spend more
than you want in \s-1AWS/EC2\s0 fees.
.PP
Please test your command line options, \s-1EBS\s0 snapshot tags, environment,
configuration files and other parameters carefully.  Examine closely
what \s-1EBS\s0 snapshots are being deleted and not deleted by this program
to make sure it's what you want.
.PP
You are responsible for what happens in your \s-1EC2\s0 account.  This
software is intended, but not guaranteed, to help in that effort.
.PP
This program tries hard to figure out some values are for the \s-1AWS\s0 key
and \s-1AWS\s0 secret access key.  In fact, it tries too hard.  This results
in possibly using some credentials it finds that are not the correct
ones you wish to use, especially if you are operating in an
environment where multiple sets of credentials are in use.
.SH "BUGS"
.IX Header "BUGS"
Please report bugs at https://bugs.launchpad.net/ec2\-consistent\-snapshot
.SH "AUTHOR"
.IX Header "AUTHOR"
Eric Hammond <ehammond@thinksome.com>
.SH "LICENSE"
.IX Header "LICENSE"
Copyright (C) 2009\-2011 Eric Hammond <ehammond@thinksome.com>
.PP
Licensed under the Apache License, Version 2.0, see
http://www.apache.org/licenses/LICENSE\-2.0
